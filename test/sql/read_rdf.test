# name: test/sql/read_rdf.test
# description: test read_rdf extension
# group: [sql]

# Before we load the extension, this will fail
statement error
SELECT * from read_rdf('Arbitrary file');
----
Catalog Error: Table Function with name read_rdf does not exist!

# Require statement will ensure this test is run with this extension loaded
require read_rdf

# Confirm the extension loads but doesn't read bad files 
statement error
SELECT * from read_rdf('not_exist.nt');
----
Invalid Error: Could not open RDF file: not_exist.nt

# Load the RDF file and check triple count
query I
SELECT COUNT(*) FROM read_rdf('tests.nt');
----
9

# Verify John Doe's name
query T
SELECT object FROM read_rdf('tests.nt')
WHERE subject='http://example.org/person/JohnDoe'
  AND predicate='http://xmlns.com/foaf/0.1/name';
----
John Doe

# Verify Jane's language-tagged name
query T
SELECT object FROM read_rdf('tests.nt')
WHERE subject LIKE 'jane%'
  AND predicate='http://xmlns.com/foaf/0.1/name';
----
Jane Smith

# Verify emoji literal
query T
SELECT object FROM read_rdf('tests.nt')
WHERE subject='http://unicode.org/duck';
----
ðŸ¦†

# Verify turtle parsing
query T
SELECT object FROM read_rdf('tests.ttl')
WHERE subject LIKE 'jane%'
  AND predicate='http://xmlns.com/foaf/0.1/name';
----
Jane Smith

# Verify nquads parsing
query T
SELECT object FROM read_rdf('tests.nq')
WHERE subject LIKE 'jane%'
  AND graph='read_rdf'
  AND predicate='http://xmlns.com/foaf/0.1/name';
----
Jane Smith

# Verify trig parsing
query T
SELECT object FROM read_rdf('tests.trig')
WHERE subject LIKE 'jane%'
  AND graph='read_rdf'
  AND predicate='foaf:name';
----
Jane Smith

### Parse error handling

# Bad ntriples
statement error
select count(*) from read_rdf('tests-bad.nt');
----
Syntax Error: SERD parsing error 3, at line 6

# Bad nquads
statement error
select count(*) from read_rdf('tests-bad.nq');
----
Syntax Error: SERD parsing error 3, at line 7

# Bad trig
statement error
select count(*) from read_rdf('tests-bad.trig');
----
Syntax Error: SERD parsing error 3, at line 12

# Bad turtle
statement error
select count(*) from read_rdf('tests-bad.ttl');
----
Syntax Error: SERD parsing error 3, at line 8
